# CLAUDE.md - Coding Assistant Reference

## Build Commands
- Build: `fish -c "cargo workspaces exec -- cargo build"`
- Check: `fish -c "cargo workspaces exec -- cargo check"`
- Run tests: `fish -c "cargo workspaces exec -- cargo test"`
- Run single test: `fish -c "cargo test test_name"` (specific crate test)
- Run tests for specific crate: `fish -c "cd crate-name && cargo test"`
- Run with release: `fish -c "cargo workspaces exec -- cargo build --release"`
- Standard workflow: Build → Check → Test (skip clippy)

## Code Style Guidelines
- **Formatting**: Use `fish -c "cargo workspaces exec -- cargo fmt"` for automatic formatting
- **Note**: Clippy linting is currently skipped in the standard workflow
- **Naming**: Use snake_case for variables/functions, CamelCase for types/traits
- **Imports**: Group std imports first, then external crates, then internal modules
- **Error Handling**: Use Result<T, E> with ? operator for propagation
- **Documentation**: Document public APIs with /// comments
- **Tests**: Place tests in `#[cfg(test)]` modules with meaningful names
- **Type Safety**: Prefer strong typing with newtype pattern (like UnitsObjectId)
- **Comments**: Explain "why" not "what" in comments
- **Traits**: Define behavior through traits for better abstraction
- Never have unused variables, imports or fields

## Commit Guidelines

- **Type** (feat, fix, refactor, style, test, docs): Description
- For code generated by claude end with [ccode] such that it is easier to identify and debug later
- Do not include attribution footers, external links, or emails in commits
- Always write tests for new features or bug fixes or refactor
- Always build, check and test before commiting
- Never push commited code


## Additional Context

- UNITS is Universal Information Tokenization System.
- UNITS is one of the components of Finternet
- The core of UNITS is the TokenizedObject, the state of the object can only be mutated by the holder
- UnitsObjectId is 32 byte public key. The key is either controlled by it's corresponding private key or by a `controller_program` in the case of `ids` that are not on the curve.
- All the objects are persisted in the storage. The storage is a key-value store, where key is the UnitsObjectId and value is the TokenizedObject as blob
- Whenever a value is set against a key in the storage, an object proof is emitted. The proof is a cryptographic proof that commits to the previous state of the object and the new state of the object.
- Time is split into slots, each slot is X milliseconds long. The slot length is a configuration parameter.
- All the object proofs from a slot are aggregated into a slot proof. The slot proof commits to the previous state of all the objects and the new state of all the objects.

## Code Structure Guidelines

- **units-core**: Contains all fundamental types (locks, transactions, scheduling primitives)
- **units-storage**: Contains storage trait definitions only
- **units-storage-impl**: Contains concrete implementations of storage traits
- **units-runtime**: Runtime and VM execution environment
- **units-kernel-sdk**: Framework for building kernel modules
- When working with storage, import traits from units-storage and implementations from units-storage-impl
- All core types (UnitsObjectId, UnitsObject, etc.) come from units-core